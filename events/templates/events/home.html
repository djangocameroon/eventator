{% extends 'events/base.html' %}

{% block header_content %}
<div
  class="inline-flex items-center gap-2 rounded-full bg-white/10 px-4 py-2 text-xs font-semibold uppercase tracking-[.2em] text-indigo-200">
  Hacktoberfest 2025 • Django Cameroon</div>
{% if messages %}
<div class="space-y-4">
  {% for message in messages %}
  <div class="rounded-lg border border-green-400/40 bg-green-500/10 px-4 py-3 text-sm text-green-200">
    {{ message }}
  </div>
  {% endfor %}
</div>
{% endif %}
<h1 class="mt-6 text-4xl font-bold sm:text-5xl lg:text-6xl">
  Eventator keeps our community inspired.
</h1>
<p class="mx-auto mt-6 max-w-2xl text-lg text-slate-200">
  Browse upcoming gatherings, coding nights, and contribution sprints. Submit your idea and let's grow the Django
  Cameroon footprint during Hacktoberfest 2025.
</p>
<div class="mt-10 flex flex-wrap items-center justify-center gap-4 text-sm text-indigo-200">
  <span class="inline-flex items-center gap-2 rounded-full border border-indigo-400/40 px-4 py-2">
    <span class="inline-flex h-2 w-2 rounded-full bg-green-400"></span>
    <strong>{{ events|length }}</strong>
    live events
  </span>
  <span class="inline-flex items-center gap-2 rounded-full border border-indigo-400/40 px-4 py-2">
    <span class="inline-flex h-2 w-2 rounded-full bg-amber-400"></span>
    <strong>{{ pending_count }}</strong>
    ideas in review
  </span>
  <a href="{% url 'events:submissions' %}"
    class="inline-flex items-center gap-2 rounded-full border border-indigo-400/40 px-4 py-2 transition hover:bg-white/10">
    View all submissions
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="h-4 w-4">
      <path fill-rule="evenodd"
        d="M8.22 5.22a.75.75 0 0 1 1.06 0l4.25 4.25a.75.75 0 0 1 0 1.06l-4.25 4.25a.75.75 0 0 1-1.06-1.06L11.94 10 8.22 6.28a.75.75 0 0 1 0-1.06Z"
        clip-rule="evenodd" />
    </svg>
  </a>
</div>
{% endblock %}

{% block main_class %}mx-auto flex max-w-6xl flex-col gap-16 px-6 py-16{% endblock %}

{% block content %}
    <section>
      <div class="flex items-center justify-between gap-4">
        <h2 class="text-2xl font-semibold text-white">Upcoming &amp; Featured Events</h2>
        <a href="#event-form"
          class="inline-flex items-center gap-2 rounded-full bg-indigo-500 px-4 py-2 text-sm font-semibold text-white shadow-lg shadow-indigo-500/30 transition hover:scale-105">
          Submit an idea
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="h-4 w-4">
            <path fill-rule="evenodd"
              d="M10.75 3.75a.75.75 0 0 0-1.5 0v5.5h-5.5a.75.75 0 0 0 0 1.5h5.5v5.5a.75.75 0 0 0 1.5 0v-5.5h5.5a.75.75 0 0 0 0-1.5h-5.5z"
              clip-rule="evenodd" />
          </svg>
        </a>
      </div>
      <div class="mt-8 grid gap-6 sm:grid-cols-2 lg:grid-cols-3">
        {% for event in events %}
        <article
          class="group flex h-full flex-col rounded-2xl border border-white/5 bg-white/5 p-6 backdrop-blur transition hover:border-indigo-400/50 hover:shadow-2xl hover:shadow-indigo-500/20">
          <div class="flex items-center justify-between text-sm text-indigo-200">
            <div class="inline-flex items-center gap-2">
              <span class="inline-flex size-2 rounded-full bg-lime-400"></span>
              {{ event.event_date|date:"M d, Y" }}
            </div>
          </div>

          <h3 class="mt-1 text-xl font-semibold text-white group-hover:text-indigo-200">
            {{ event.title }}
          </h3>
          <div class="flex items-center justify-start gap-2 w-fit mt-2">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" fill="none" class="text-indigo-300 size-4">
              <path
                d="M15.5 11C15.5 12.933 13.933 14.5 12 14.5C10.067 14.5 8.5 12.933 8.5 11C8.5 9.067 10.067 7.5 12 7.5C13.933 7.5 15.5 9.067 15.5 11Z"
                stroke="currentColor" stroke-width="1.5" />
              <path
                d="M12 2C16.8706 2 21 6.03298 21 10.9258C21 15.8965 16.8033 19.3847 12.927 21.7567C12.6445 21.9162 12.325 22 12 22C11.675 22 11.3555 21.9162 11.073 21.7567C7.2039 19.3616 3 15.9137 3 10.9258C3 6.03298 7.12944 2 12 2Z"
                stroke="currentColor" stroke-width="1.5" />
            </svg>
            <div class="rounded-lg bg-indigo-300/20 px-3 italic py-1 text-xs uppercase tracking-wider">
              {{ event.location }}
            </div>
          </div>

          <div x-data="{ showFull: false }" class="my-3 text-sm text-slate-200/80">
            <p :class="showFull ? '' : 'line-clamp-4 text-overflow-ellipsis'">
              {{ event.description }}
            </p>
            {% if event.description|length > 160 %}
              <button
                type="button"
                @click="showFull = !showFull"
                class="mt-2 text-xs text-indigo-300 underline decoration-dotted underline-offset-4 hover:text-indigo-100 transition-all"
              >
                <span x-show="!showFull">Show more</span>
                <span x-show="showFull">Show less</span>
              </button>
            {% endif %}
          </div>
          <hr class="border-t border-white/10" />
          <div class="mt-4 flex items-center justify-between">
            <div class="flex items-center gap-4 text-xs text-indigo-100/80">
              <div class="flex items-center gap-2">
                <dt class="font-semibold uppercase tracking-wide text-indigo-200">Organizer</dt>
                <dd>{{ event.organizer }}</dd>
              </div>
              {% if event.registration_url %}
              <div class="flex items-center gap-2">
                <dt class="font-semibold uppercase tracking-wide text-indigo-200">Register</dt>
                <dd>
                  <a href="{{ event.registration_url }}" target="_blank" rel="noopener noreferrer"
                    class="text-indigo-300 underline decoration-dotted underline-offset-4 hover:text-indigo-100">
                    Event page
                  </a>
                </dd>
              </div>
              {% endif %}
            </div>
            <div class="flex items-center gap-2">
              <button 
                class="vote-btn group flex items-center gap-2 rounded-full border border-indigo-400/40 px-3 py-2 text-xs font-semibold text-indigo-200 transition hover:border-indigo-400 hover:bg-indigo-500/20 {% if user.is_authenticated and event.is_liked_by_user %}bg-indigo-500/20 border-indigo-400{% endif %}"
                data-event-id="{{ event.id }}"
                {% if not user.is_authenticated %}disabled title="Please log in to vote"{% endif %}>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="none" class="vote-icon">
                  <path d="M7.5 21L12 16.5L16.5 21M12 2V16.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <span class="vote-count">{{ event.vote_count }}</span>
                <span class="vote-text">{% if user.is_authenticated and event.is_liked_by_user %}Liked{% else %}Like{% endif %}</span>
              </button>
            </div>
          </div>
        </article>
        {% empty %}
        <p class="mt-8 rounded-xl border border-indigo-300/30 bg-white/5 p-6 text-sm text-indigo-100/80">
        No events have been published yet. Be the first to share an idea below - our team will review it and make it
        shine ✨.
      </p>
        {% endfor %}
      </div>
    </section>

    <section id="event-form"
      class="rounded-3xl border border-white/5 bg-white/5 px-6 py-10 shadow-2xl shadow-indigo-900/40 md:px-10">
      <div class="flex flex-col gap-6 md:flex-row md:items-start md:justify-between">
        <div class="md:max-w-sm">
          <h2 class="text-2xl font-semibold text-white">Share your event idea</h2>
          <p class="mt-3 text-sm text-indigo-100/80">
            Fill out the form and we will review your proposal. Once the organizing team approves it, the event will
            appear in the live list for everyone to join.
          </p>
        </div>
        <form method="post" class="flex-1 space-y-4">
          {% csrf_token %}
          {% for field in form %}
          <div>
            <label class="mb-2 block text-xs font-semibold uppercase tracking-widest text-indigo-200"
              for="{{ field.id_for_label }}">
              {{ field.label }}
            </label>
            {{ field }}
            {% if field.help_text %}
            <p class="mt-1 text-xs text-indigo-200/70">{{ field.help_text }}</p>
            {% endif %}
            {% for error in field.errors %}
            <p class="mt-1 text-xs text-rose-300">{{ error }}</p>
            {% endfor %}
          </div>
          {% endfor %}
          <button type="submit"
            class="inline-flex w-full items-center justify-center gap-2 rounded-full bg-indigo-500 px-5 py-3 font-semibold text-white shadow-lg shadow-indigo-500/40 transition hover:translate-y-[-1px] hover:bg-indigo-400">
            Send idea
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="h-4 w-4">
              <path
                d="M2.94 2.94a.75.75 0 0 1 .82-.165l13 5a.75.75 0 0 1 0 1.39l-13 5A.75.75 0 0 1 2 13.5v-3.318a.75.75 0 0 1 .574-.728L9.5 8l-6.926-1.454A.75.75 0 0 1 2 5.818V2.5a.75.75 0 0 1 .94-.56z" />
            </svg>
          </button>
        </form>
      </div>
    </section>
{% endblock %}

{% block extra_head %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const voteButtons = document.querySelectorAll('.vote-btn');
    
    voteButtons.forEach(button => {
        button.addEventListener('click', function(e) {
            e.preventDefault();
            
            if (this.disabled) {
                return;
            }
            
            const eventId = this.dataset.eventId;
            const voteCount = this.querySelector('.vote-count');
            const voteText = this.querySelector('.vote-text');
            const voteIcon = this.querySelector('.vote-icon');
            
            // Add loading state
            this.disabled = true;
            this.classList.add('opacity-50');
            
            fetch(`/vote/${eventId}/`, {
                method: 'POST',
                headers: {
                    'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
                    'Content-Type': 'application/json',
                },
                credentials: 'same-origin'
            })
            .then(response => response.json())
            .then(data => {
                // Update UI
                voteCount.textContent = data.vote_count;
                voteText.textContent = data.voted ? 'Liked' : 'Like';
                
                if (data.voted) {
                    this.classList.add('bg-indigo-500/20', 'border-indigo-400');
                    voteIcon.style.fill = 'currentColor';
                } else {
                    this.classList.remove('bg-indigo-500/20', 'border-indigo-400');
                    voteIcon.style.fill = 'none';
                }
            })
            .catch(error => {
                console.error('Error voting:', error);
                alert('Error voting. Please try again.');
            })
            .finally(() => {
                // Remove loading state
                this.disabled = false;
                this.classList.remove('opacity-50');
            });
        });
    });
});
</script>
{% endblock %}
